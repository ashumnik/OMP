# Отчет по лабораторной работе №6

В данной лабораторной работе
был модифицирован код лабораторной работы №4.

Время исполнения программ измерялось по всей функции `main()`.
В качестве сегмента для исследования производительности 
были выбраны сегменты где использовалась директива `#pragma omp critical`:

## Семафорная синхронизация
### Лабораторная №4 предыдущая

```C++
        #pragma omp parallel for 
        for(int i = 0; i < N; i++){
            #pragma omp critical
            {
                final_calc(&partial_result, C[i]);
                result *= partial_result;
            }
        }   
        return result;
```

### Лабораторная 4 модифицированная

```C++
    #pragma omp parallel for 
    for(int i = 0; i < N; i++){
        omp_set_lock(&lock);
            final_calc(&partial_result, C[i]);
            result *= partial_result;
        omp_unset_lock(&lock);
    }
    omp_destroy_lock(&lock);
    return result;
```

## Замеры времени:

| Количество элементов | Лаб №4 new (мс) | Лаб №4 (мс)     | Отношение времени |
| ---------------      | --------------- | --------------- | --------------    |
| 1000000              | 167452          | 852798          | 5.092             |
| 100000               | 20292           | 40646           | 2.003             |
| 10000                | 3782            | 5293            | 1.399             |
| 1000                 | 1252            | 870             | 0.694             |

### Вывод

Выигрыш от использования семафоров явно происходит из-за особенностей генерации кода
компилятором в секциях `critical`. `critical` блокирует весь сегмент кода, не давая в нем
исполняться каким-либо двум потокам одновременно. Семафоры же блокируют только доступ к данным
внутри себя.
